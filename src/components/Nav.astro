---
import { normalizeLang, siteCopy, type SiteLang } from "../i18n/site";

const lang = normalizeLang(Astro.props.lang as SiteLang);
const rawPath = Astro.url.pathname;
const basePath = rawPath.replace(/^\/(en|de)(?=\/|$)/, "") || "/";
const prefix = lang === "pl" ? "" : `/${lang}`;
const onPricing = basePath.startsWith("/cennik");
const activePath = basePath.endsWith("/") && basePath !== "/" ? basePath.slice(0, -1) : basePath;

const mapHref = (href: string) => {
    if (href.startsWith("#")) return href;
    if (href.startsWith("/#")) return `${prefix}${href}`;
    if (href === "/cennik") return `${prefix}/cennik`;
    return `${prefix}${href}`;
};

const navCopy = siteCopy[lang].nav;

const links = navCopy.links.map((link) => {
    const href = link.href.includes("#dekoracje") && onPricing ? "#dekoracje" : link.href;
    const finalHref = mapHref(href);
    const active =
        link.href === "/cennik" ? activePath.startsWith("/cennik") : activePath === "/" && link.href !== "/cennik";
    return { ...link, href: finalHref, active };
});

const languages = [
    { code: "pl", label: "PL" },
    { code: "en", label: "EN" },
    { code: "de", label: "DE" },
].map((l) => {
    const base = activePath === "/" ? "/" : activePath || "/";
    const href = l.code === "pl" ? base : `/${l.code}${base}`;
    return { ...l, href };
});
---

<div class="py-0 navigation" data-astro-cid-3ef6ksr2>
    <div class="container mx-auto" data-astro-cid-3ef6ksr2>
        <div
            class="relative flex flex-col w-full py-5 mx-auto xl:items-center xl:justify-between xl:flex-row"
            data-astro-cid-3ef6ksr2
        >
            <!-- Logo -->
            <div class="flex flex-row items-center justify-between xl:justify-start" data-astro-cid-3ef6ksr2>
                <a
                    href={prefix || "/"}
                    class="lg:pr-8 text-black inline-flex items-center gap-3"
                    aria-label={lang === "pl" ? "Strona główna" : lang === "en" ? "Home" : "Startseite"}
                    data-astro-cid-3ef6ksr2
                >
                    <svg
                        width="170"
                        height="52"
                        viewBox="0 0 170 52"
                        fill="none"
                        xmlns="http://www.w3.org/2000/svg"
                        data-astro-cid-3ef6ksr2=""
                    >
                        <path
                            d="M89.5149 0.285706V14.3042H87.8457V0.285706H89.5149Z"
                            fill="#151515"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M84.5057 0.285706V14.3042H82.8904L75.379 3.29749H75.2444V14.3042H73.5752V0.285706H75.1905L82.7289 11.3198H82.8635V0.285706H84.5057Z"
                            fill="#151515"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M61.333 14.3042H59.583L64.6444 0.285706H66.3675L71.4289 14.3042H69.679L65.5598 2.50347H65.4521L61.333 14.3042ZM61.9791 8.82822H69.0328V10.3341H61.9791V8.82822Z"
                            fill="#151515"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M50.1436 14.3042V0.285706H54.8012C55.8825 0.285706 56.7665 0.484209 57.453 0.881217C58.144 1.27366 58.6556 1.80529 58.9876 2.47609C59.3197 3.1469 59.4857 3.89528 59.4857 4.72124C59.4857 5.5472 59.3197 6.29786 58.9876 6.97323C58.6601 7.6486 58.153 8.18707 57.4665 8.58864C56.78 8.98565 55.9005 9.18415 54.8281 9.18415H51.4897V7.67826H54.7742C55.5146 7.67826 56.1091 7.54821 56.5578 7.2881C57.0066 7.02799 57.3319 6.67662 57.5338 6.23398C57.7402 5.78677 57.8434 5.28253 57.8434 4.72124C57.8434 4.15995 57.7402 3.65799 57.5338 3.21535C57.3319 2.77271 57.0043 2.4259 56.5511 2.17491C56.0979 1.91937 55.4967 1.7916 54.7473 1.7916H51.8128V14.3042H50.1436Z"
                            fill="#151515"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M147.704 22.3155V20.5273H152.628V13.732L159.38 12.2298V20.5273H169.578V22.3155H159.38V44.0606C159.427 47.6371 160.646 49.473 163.037 49.5684C165.382 49.5207 167.07 47.3748 168.101 43.1307L170 43.4884C169.86 44.2513 169.672 44.9905 169.438 45.7058C168.125 49.7115 165.475 51.7143 161.49 51.7143C161.115 51.7143 160.716 51.6904 160.294 51.6428C155.183 51.1659 152.628 47.804 152.628 41.5571V22.3155H147.704Z"
                            fill="#8CAE6B"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M139.616 51.6428C136.099 51.5951 133.989 49.4492 133.285 45.2051C132.91 46.1588 132.371 47.0649 131.668 47.9232C129.511 50.4029 126.65 51.6428 123.087 51.6428C121.633 51.6428 120.297 51.4043 119.078 50.9275C115.842 49.6399 114.225 47.0887 114.225 43.2738C114.225 42.5585 114.295 41.867 114.436 41.1994C115.608 36.1446 121.821 33.5457 133.074 33.4027V28.8248C133.028 23.913 131.105 21.4095 127.307 21.3141C126.369 21.3141 125.572 21.481 124.916 21.8148C124.025 22.3394 123.274 23.5554 122.665 25.4629C122.524 25.9397 122.407 26.2974 122.313 26.5358C121.75 28.1095 120.742 28.8963 119.289 28.8963C118.914 28.8963 118.538 28.8486 118.163 28.7532C116.757 28.324 116.053 27.3465 116.053 25.8205C116.053 25.0098 116.311 24.1992 116.827 23.3885C118.562 20.8134 122.266 19.5259 127.94 19.5259C135.771 19.5736 139.733 23.2693 139.827 30.613V45.6343C139.873 47.9709 140.46 49.1869 141.585 49.2823C143.039 49.2346 143.929 47.5179 144.258 44.1321L146.086 44.2037C146.04 45.3005 145.899 46.278 145.664 47.1364C144.914 50.1406 142.898 51.6428 139.616 51.6428ZM125.971 48.71C126.674 48.71 127.401 48.5431 128.151 48.2093C130.636 47.1125 132.277 44.8951 133.074 41.5571V35.334C130.308 35.3817 128.057 35.6201 126.322 36.0493C122.946 36.9076 121.258 38.9581 121.258 42.2008C121.258 42.8684 121.305 43.4884 121.399 44.0606C121.868 47.1602 123.392 48.71 125.971 48.71Z"
                            fill="#8CAE6B"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M108.668 49.1392C108.996 49.1392 109.277 49.1631 109.512 49.2108C110.121 49.3061 110.426 49.8784 110.426 50.9275H93.7568V49.1392C94.9291 49.1392 95.8434 49.0677 96.4999 48.9246C98.0004 48.4955 98.7506 47.2079 98.7506 45.062V22.1725H93.7568V20.3842H105.503V49.1392H108.668ZM106.276 10.3701C106.276 11.0854 106.136 11.753 105.854 12.3729C105.057 13.9942 103.721 14.8049 101.845 14.8049C101.189 14.8049 100.556 14.6618 99.9463 14.3757C98.3052 13.6127 97.4846 12.2775 97.4846 10.3701C97.4846 9.65476 97.6487 8.9633 97.9769 8.29569C98.7741 6.67435 100.064 5.86368 101.845 5.86368C102.549 5.86368 103.229 6.03058 103.885 6.36439C105.479 7.22274 106.276 8.55797 106.276 10.3701Z"
                            fill="#8CAE6B"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M58.1679 22.1725H53.3147L61.4033 45.4197L66.7487 28.6817L63.9353 20.3842H75.822V22.1725H71.1799L78.9167 45.3482L86.2316 22.1725H81.5191V20.3842H91.788C91.788 20.6704 91.7646 20.9326 91.7177 21.1711C91.577 21.8387 91.0378 22.1725 90.1 22.1725C89.8656 22.1725 89.6311 22.1963 89.3967 22.244C88.6464 22.3871 88.0368 23.1501 87.5679 24.533L78.9167 51.2851H77.299C76.455 51.2851 75.7751 51.1659 75.2593 50.9275C74.5091 50.4983 73.665 48.9246 72.7272 46.2065L67.8038 31.7575L61.5439 51.2851H59.7152C58.965 51.2851 58.3554 51.1898 57.8865 50.999C56.9018 50.5698 55.9171 48.9723 54.9324 46.2065L46.3516 22.1725H43.3271V20.3842H58.1679V22.1725Z"
                            fill="#8CAE6B"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            d="M18.7795 50.9275H0V49.0677H5.62681V9.86936H0V8.00958H18.7795V9.86936H13.1527V28.8963L33.6202 9.86936H27.9934V8.00958H40.7944C40.7944 8.24802 40.7709 8.48645 40.724 8.72488C40.6303 9.48787 40.0441 9.86936 38.9657 9.86936C38.5437 9.86936 38.1216 9.91704 37.6996 10.0124C36.9025 10.2509 35.5192 11.2523 33.5499 13.0167L21.8039 24.1038L39.669 49.0677H41.0757C41.3102 49.0677 41.5446 49.0915 41.7791 49.1392C42.5293 49.2823 42.9044 49.8784 42.9044 50.9275H31.6508L16.3178 29.2539L13.1527 32.1867V49.0677H16.9508C17.1852 49.0677 17.4197 49.0915 17.6541 49.1392C18.4044 49.2823 18.7795 49.8784 18.7795 50.9275Z"
                            fill="#8CAE6B"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                    </svg>
                </a>
                <button
                    id="nav-toggle"
                    class="inline-flex items-center justify-center p-2 text-slate-400 hover:text-black focus:outline-none focus:text-black xl:hidden"
                    aria-label={navCopy.ariaOpen}
                    aria-expanded="false"
                    type="button"
                    data-astro-cid-3ef6ksr2
                >
                    <svg
                        class="w-6 h-6"
                        stroke="#222"
                        fill="none"
                        style="transform: rotate(180deg);"
                        viewBox="0 0 24 24"
                        data-astro-cid-3ef6ksr2=""
                    >
                        <path
                            id="icon-menu"
                            class="inline-flex"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 6h14M4 12h32M4 18h14"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                        <path
                            id="icon-close"
                            class="hidden"
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M6 18L18 6M6 6l12 12"
                            data-astro-cid-3ef6ksr2=""
                        >
                        </path>
                    </svg>
                </button>
            </div>

            <div id="nav-overlay" class="hidden navigation-overlay" data-astro-cid-3ef6ksr2></div>

            <nav
                id="primary-nav"
                class="flex-col xl:items-center flex-grow hidden xl:pb-0 xl:flex xl:justify-end xl:flex-row xl:flex-nowrap gap-2 xl:gap-x-2"
                data-astro-cid-3ef6ksr2
            >
                {
                    links.map((l) => (
                        <a
                            data-astro-cid-3ef6ksr2
                            class={`px-2 py-2 text-sm menu-link ${l.active ? "active" : ""}`}
                            href={l.href}
                        >
                            {l.label}
                            <span data-astro-cid-3ef6ksr2>{l.sub}</span>
                        </a>
                    ))
                }
                <div class="lang-switch mt-2 xl:mt-0 xl:ml-2 flex-shrink-0">
                    {
                        languages.map((l) => (
                            <a class={`lang-pill ${l.code === lang ? "active" : ""}`} href={l.href}>
                                {l.label}
                            </a>
                        ))
                    }
                </div>
            </nav>
        </div>
    </div>
</div>

<script is:inline>
    const btn = document.querySelector("#nav-toggle");
    const nav = document.querySelector("#primary-nav");
    const iconMenu = document.querySelector("#icon-menu");
    const iconClose = document.querySelector("#icon-close");
    const overlay = document.querySelector("#nav-overlay");
    const navLabels = { open: "${navCopy.ariaOpen}", close: "${navCopy.ariaClose}" };

    btn?.addEventListener("click", () => {
        const isOpen = nav.classList.toggle("hidden");
        const expanded = !isOpen;
        btn.setAttribute("aria-expanded", expanded);
        btn.setAttribute("aria-label", expanded ? navLabels.close : navLabels.open);

        iconMenu.classList.toggle("hidden", expanded);
        iconClose.classList.toggle("hidden", !expanded);
        overlay.classList.toggle("hidden", !expanded);
    });
</script>

<style>
    .header[data-astro-cid-3ef6ksr2] {
        display: none;
        background-color: #8cae6b;
        padding-top: 3px;
        padding-bottom: 3px;
    }

    .header[data-astro-cid-3ef6ksr2] [data-astro-cid-3ef6ksr2] {
        color: #fff;
        font-size: 13px;
        margin-bottom: 0;
    }

    @media screen and (min-width: 1200px) {
        .header[data-astro-cid-3ef6ksr2] {
            display: block;
        }
    }

    .header-phone[data-astro-cid-3ef6ksr2] {
        display: flex;
        line-height: 18px;
    }

    .header-phone[data-astro-cid-3ef6ksr2] span[data-astro-cid-3ef6ksr2] {
        margin-top: 2px;
    }

    .header-phone[data-astro-cid-3ef6ksr2] svg[data-astro-cid-3ef6ksr2] {
        width: 18px;
        height: 18px;
    }

    .header-wrapper[data-astro-cid-3ef6ksr2] {
        display: flex;
        align-items: center;
        margin-right: auto;
    }

    .header-wrapper[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2] {
        margin-left: 8px;
        transition: 0.3s ease-in-out all;
        flex-direction: row;
        display: flex;
        align-items: center;
    }

    @media screen and (min-width: 1366px) {
        .header-wrapper[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2] {
            margin-left: 16px;
        }
    }

    .header-wrapper[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]:hover {
        opacity: 0.6;
    }

    .header-wrapper[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2] svg[data-astro-cid-3ef6ksr2] {
        margin-right: 10px;
    }

    a[data-astro-cid-3ef6ksr2] {
        display: flex;
        flex-direction: column;
        text-align: left;
        align-items: start;
        color: #151515;
        font-size: 13px;
        font-weight: 700;
        line-height: normal;
        text-transform: uppercase;
    }
    @media screen and (min-width: 1280px) {
        a[data-astro-cid-3ef6ksr2] {
            align-items: center;

            text-align: center;
            white-space: nowrap;
            font-size: 12px;
        }
    }

    a[data-astro-cid-3ef6ksr2] span[data-astro-cid-3ef6ksr2] {
        color: #8cae6bcc;
        font-size: 10px;
        font-weight: 600;
        line-height: normal;
        letter-spacing: 0.8px;
        text-transform: uppercase;
    }

    @media screen and (min-width: 1200px) {
        a[data-astro-cid-3ef6ksr2] span[data-astro-cid-3ef6ksr2] {
            text-align: center;
        }
    }

    .navigation-overlay[data-astro-cid-3ef6ksr2] {
        background-color: #000;
        position: fixed;
        height: 100vh;
        width: 100vw;
        top: 448px;
        left: 0%;
        opacity: 0.5;
        z-index: -1;
    }

    @media screen and (min-width: 1280px) {
        .navigation-overlay[data-astro-cid-3ef6ksr2] {
            display: none;
        }
    }

    .lang-switch {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 0;
        padding: 8px;
    }
    @media screen and (min-width: 1280px) {
        .lang-switch {
            display: flex;
            gap: 8px;
        }
    }
    .lang-pill {
        padding: 5px 9px;
        border-radius: 999px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        color: #151515;
        border: 1px solid transparent;
        transition: 0.2s ease-in-out all;
        width: 45px;
        height: 35px;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    .lang-pill:hover {
        border-color: #2d2d2d33;
        background: #e6e6e6;
    }

    .lang-pill.active {
        background: #8cae6b;
        color: #fff;
        border-color: #8cae6b;
        box-shadow: 0 6px 14px -8px rgba(0, 0, 0, 0.35);
    }
</style>
